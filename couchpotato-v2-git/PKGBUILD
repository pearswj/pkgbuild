# Maintainer: pearsw <wpearson01 at gmail dot com>

pkgname='couchpotato-v2-git'
pkgver=20120428
pkgrel=1
pkgdesc='CouchPotato V2 - automatic movie downloading via NZBs & torrents.'
arch=('any')
url='http://help.couchpota.to/discussions/v2'
license=('GPL')
depends=('python2')
makedepends=('git')
backup=('etc/conf.d/couchpotato-v2')
install='couchpotato-v2.install'
conflicts=('couchpotato-git')
source=('couchpotato-v2.confd' 'couchpotato-v2.init' 'couchpotato-v2.sh')
md5sums=('1342a5e20424ca4d54efe50fd57ee741'
         '75d561e0a4908238814e33242be0bf3e'
         'd14a439c5bc200892de2627e9acbc2a0')

_gitroot='git://github.com/RuudBurger/CouchPotatoServer.git'
_gitname='CouchPotatoServer'

build() {
  cd "$srcdir"
  msg 'Connecting to GIT server....'

  if [ -d "${_gitname}" ] ; then
    cd "${_gitname}" && git pull origin
    msg 'The local files are updated.'
  else
    git clone $_gitroot $_gitname
  fi

  msg 'GIT checkout done or server timeout'
}

package() {
  mkdir -p "${pkgdir}/usr/share/"
  cp -r "$srcdir/$_gitname" "${pkgdir}/usr/share/couchpotato-v2"

  install -D -m755 "${srcdir}/couchpotato-v2.sh" "${pkgdir}/usr/bin/couchpotato-v2"
  install -D -m755 "${srcdir}/couchpotato-v2.init" "${pkgdir}/etc/rc.d/couchpotato-v2"
  install -D -m644 "${srcdir}/couchpotato-v2.confd" "${pkgdir}/etc/conf.d/couchpotato-v2"
}
